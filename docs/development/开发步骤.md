# MultiForms 开发步骤指南

> 本文档将 MultiForms 项目开发拆分为 20 个可独立执行的步骤，每个步骤都可以通过向 Claude 提供相应的提示词来完成。

## 使用说明

1. **按顺序执行** - 建议从 Step 1 开始按顺序执行，每个步骤完成后验证再继续下一步
2. **复制提示词** - 每个步骤都配有「执行提示词」，直接复制发送给 Claude 即可
3. **自动验证** - 每个提示词末尾都包含「【自动验证】」指令，Claude 完成任务后会自动执行验证并报告结果
4. **手动验证** - 对于需要浏览器交互的功能，自动验证会提醒用户进行手动测试
5. **参考文档** - 遇到问题时查看「参考文档」链接

### 自动验证说明

每个步骤的「【自动验证】」会执行以下检查：
- **文件检查**：验证必需的文件/目录是否已创建
- **代码检查**：运行 `npx tsc --noEmit` 检查 TypeScript 类型错误
- **构建检查**：运行 `pnpm build` 检查项目是否能成功构建
- **逻辑验证**：验证代码逻辑是否完整（如所有 CRUD 方法、所有路由等）

自动验证通过后，Claude 会报告验证结果。如有问题会自动修复。

---

## 前置准备

### 环境要求

| 软件 | 版本要求 | 用途 |
|------|----------|------|
| Node.js | >= 18.17.0 | 运行 Next.js |
| pnpm | >= 8.0.0 | 包管理器 |
| Git | >= 2.0 | 版本控制 |
| VS Code | 最新版 | 推荐IDE |

### 账号准备

| 服务 | 用途 | 备注 |
|------|------|------|
| [GitHub](https://github.com) | 代码托管 | 需要创建仓库 |
| [Vercel](https://vercel.com) | 前端部署 | 连接 GitHub 账号 |
| [Supabase](https://supabase.com) | 后端服务 | 创建免费项目 |

### 安装 Supabase CLI

```bash
# Windows (PowerShell)
npm install -g supabase

# 验证安装
supabase --version
```

---

## 步骤总览

| 阶段 | 步骤 | 内容 | 状态 |
|------|------|------|------|
| **阶段0: 公开页面** | Step 0 | Landing Page（首页） | ✅ 已完成 |
| **阶段1: 项目初始化** | Step 1-5 | 项目搭建、基础配置、目录结构 | ⬜ 待开始 |
| **阶段2: Supabase 后端** | Step 6-8 | 数据库设计、认证配置、RLS策略 | ⬜ 待开始 |
| **阶段3: 基础布局** | Step 9-10 | 导航组件、布局结构 | ⬜ 待开始 |
| **阶段4: 认证系统** | Step 11-13 | 登录注册、用户状态、路由守卫 | ⬜ 待开始 |
| **阶段5: 核心功能** | Step 14-16 | 表单CRUD、题库组件、拖拽功能 | ⬜ 待开始 |
| **阶段6: 表单功能** | Step 17-18 | 表单填写、数据统计 | ⬜ 待开始 |
| **阶段7: 主题系统** | Step 19 | 8套主题切换 | ⬜ 待开始 |
| **阶段8: 部署上线** | Step 20 | Vercel + Supabase 部署 | ⬜ 待开始 |

---

### Step 0: 实现 Landing Page（首页）✅ 已完成

**完成日期**: 2026-01-31

**实现内容**:
- LandingNavbar（导航栏，含滚动效果和移动端菜单）
- HeroSection（Hero区域，渐变背景和CTA按钮）
- FeaturesSection（6个功能特性卡片）
- TemplatesSection（8个模板展示卡片）
- TestimonialsSection（用户评价轮播）
- CTASection（行动号召区域）
- LandingFooter（页脚）

**文件路径**:
- `src/app/page.tsx` - 首页入口
- `src/components/landing/index.ts` - 组件导出
- `src/components/landing/*.tsx` - 各个section组件
- `src/app/globals.css` - 添加 animate-pulse-slow 动画

**部署状态**: 已部署到 Vercel
- URL: https://multiforms-filc7o0xa-greatnanjings-team.vercel.app/

---

## 详细步骤

### 阶段1: 项目初始化 (Step 1-5)

---

#### Step 1: 创建 Next.js 项目

**目标**: 初始化 Next.js 16 项目，配置 TypeScript 和 Tailwind CSS

**前置依赖**: Node.js 18+, pnpm

**执行提示词**:
```
请帮我创建一个 Next.js 16 项目，使用以下配置：
- 使用 pnpm 作为包管理器
- TypeScript: 是
- ESLint: 是
- Tailwind CSS: 是
- App Router: 是
- src 目录: 是
- 导入别名: @/*

项目初始化后，请运行 pnpm install 安装依赖。

【自动验证】
完成后请自动执行以下验证：
1. 检查关键文件是否存在：package.json, tsconfig.json, tailwind.config.ts, src/app/layout.tsx
2. 尝试运行 pnpm dev，等待5秒后检查是否启动成功
3. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/deployment/01-Vercel部署指南.md](../deployment/01-Vercel部署指南.md)

---

#### Step 2: 安装核心依赖

**目标**: 安装所有必需的 npm 包

**前置依赖**: Step 1 完成

**执行提示词**:
```
请帮我安装以下依赖包：

核心依赖：
pnpm add @supabase/supabase-js @supabase/auth-helpers-nextjs
pnpm add zustand react-hook-form zod
pnpm add @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
pnpm add framer-motion recharts lucide-react
pnpm add date-fns clsx tailwind-merge

开发依赖：
pnpm add -D @supabase/cli
pnpm add -D @types/node

初始化 shadcn/ui：
pnpm dlx shadcn@latest init
使用默认配置即可。

【自动验证】
完成后请自动执行以下验证：
1. 读取 package.json，检查所有依赖是否正确安装
2. 检查 src/components.json 和 src/lib/utils.ts 是否存在
3. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/requirements/02-技术需求文档-TRD.md](../requirements/02-技术需求文档-TRD.md#技术栈)

---

#### Step 3: 配置环境变量和 Supabase 客户端

**目标**: 配置环境变量和 Supabase 客户端

**前置依赖**: Step 2 完成，已创建 Supabase 项目

**执行提示词**:
```
请帮我配置 Supabase：

1. 创建 .env.local 文件，包含以下变量：
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

2. 创建 src/lib/supabase/client.ts（浏览器客户端）
3. 创建 src/lib/supabase/server.ts（服务器端客户端）
4. 创建 src/proxy.ts（Next.js 16 路由代理，替代 middleware.ts）

使用 @supabase/auth-helpers-nextjs 提供的工具。
参考 docs/deployment/02-Supabase配置指南.md 中的代码示例。

【自动验证】
完成后请自动执行以下验证：
1. 检查 src/lib/supabase/ 目录下所有文件是否存在
2. 检查 .env.local 文件是否存在（提醒用户填写实际值）
3. 验证代码中是否有 TypeScript 类型错误
4. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/deployment/02-Supabase配置指南.md](../deployment/02-Supabase配置指南.md)

---

#### Step 4: 配置 Tailwind 和设计系统

**目标**: 配置 Tailwind CSS 以匹配 MultiForms 设计系统

**前置依赖**: Step 2 完成

**执行提示词**:
```
请帮我配置 Tailwind CSS 以匹配 MultiForms 设计系统：

1. 更新 tailwind.config.ts：
   - 添加设计系统的颜色变量（参考 docs/design/01-UI-UX设计系统.md）
   - 添加字体配置（Space Grotesk, DM Sans, JetBrains Mono）
   - 添加动画和断点配置

2. 更新 src/app/globals.css：
   - 导入 Google Fonts
   - 添加 CSS 变量（颜色、间距、圆角、动画）
   - 添加基础样式重置

3. 创建主题系统 CSS 变量文件（8套主题）

参考 design-pages/common.css 和 design-pages/theme-system.css 中的配置。

【自动验证】
完成后请自动执行以下验证：
1. 检查 tailwind.config.ts 是否包含正确的颜色、字体、动画配置
2. 检查 globals.css 是否包含所有必要的 CSS 变量
3. 运行 pnpm build 检查是否有构建错误
4. 报告验证结果，如有问题请修复
```

**参考文档**:
- [docs/design/01-UI-UX设计系统.md](../design/01-UI-UX设计系统.md)
- [design-pages/common.css](../../design-pages/common.css)
- [design-pages/theme-system.css](../../design-pages/theme-system.css)

---

#### Step 5: 创建项目目录结构和类型定义

**目标**: 创建完整的目录结构和 TypeScript 类型定义

**前置依赖**: Step 3 完成

**执行提示词**:
```
请帮我创建以下目录结构和类型定义：

1. 创建目录结构：
src/
├── app/              # Next.js App Router
├── components/       # React 组件
│   ├── ui/          # shadcn/ui 组件
│   ├── layout/      # 布局组件
│   ├── forms/       # 表单相关组件
│   └── shared/      # 共享组件
├── lib/             # 工具函数
│   └── supabase/   # Supabase 客户端
├── hooks/           # 自定义 Hooks
├── stores/          # Zustand 状态管理
├── types/           # TypeScript 类型
└── styles/          # 全局样式

2. 创建 src/types/index.ts，定义以下类型：
- Form（表单）
- FormQuestion（题目）
- FormSubmission（提交）
- User（用户）
- Template（模板）
- Theme（主题）

参考 docs/requirements/02-技术需求文档-TRD.md 中的数据库表结构。

【自动验证】
完成后请自动执行以下验证：
1. 检查所有目录是否创建成功
2. 检查 src/types/index.ts 是否包含所有必需的类型定义
3. 运行 npx tsc --noEmit 检查是否有 TypeScript 类型错误
4. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/requirements/02-技术需求文档-TRD.md](../requirements/02-技术需求文档-TRD.md#数据库设计)

---

### 阶段2: Supabase 后端 (Step 6-8)

---

#### Step 6: 创建数据库迁移文件

**目标**: 创建所有数据库表的 SQL 迁移文件

**前置依赖**: Step 3 完成，Supabase CLI 已安装

**执行提示词**:
```
请帮我创建 Supabase 数据库迁移文件：

1. 初始化 Supabase 本地环境（如果还没有）：
supabase init

2. 创建迁移文件 supabase/migrations/001_initial_schema.sql

包含以下表：
- profiles（用户资料）
- forms（表单）
- form_questions（题目）
- form_submissions（提交）
- form_answers（答案）
- templates（模板）
- notifications（通知）
- admin_logs（管理员日志）
- content_reviews（内容审核）
- system_settings（系统设置）

参考 docs/requirements/02-技术需求文档-TRD.md 中的完整数据库表结构。

每个表需要包含正确的字段、索引、外键约束。

【自动验证】
完成后请自动执行以下验证：
1. 检查 supabase/migrations/001_initial_schema.sql 文件是否存在
2. 验证 SQL 语法是否正确（检查是否有语法错误）
3. 确认所有表、索引、外键是否已定义
4. 报告验证结果，提醒用户手动运行 supabase db push 推送到远程
```

**参考文档**: [docs/requirements/02-技术需求文档-TRD.md](../requirements/02-技术需求文档-TRD.md#数据库设计)

---

#### Step 7: 配置 Row Level Security (RLS) 策略

**目标**: 配置所有表的 RLS 安全策略

**前置依赖**: Step 6 完成

**执行提示词**:
```
请帮我创建 RLS 策略迁移文件 supabase/migrations/002_rls_policies.sql：

包含以下策略：
1. profiles 表：用户只能读写自己的资料
2. forms 表：创建者可以读写，guest有限制
3. form_questions 表：关联 forms 表的权限
4. form_submissions 表：表单创建者可以读，任何人可以创建
5. templates 表：所有人可读，只有 admin 可写
6. notifications 表：用户只能读自己的通知
7. admin_logs 表：只有 admin 可读可写
8. content_reviews 表：只有 admin 可读可写
9. system_settings 表：所有人可读，只有 admin 可写

参考 docs/requirements/02-技术需求文档-TRD.md 中的 RLS 策略章节。

【自动验证】
完成后请自动执行以下验证：
1. 检查 supabase/migrations/002_rls_policies.sql 文件是否存在
2. 验证 SQL 语法是否正确
3. 确认每个表都有对应的 RLS 策略
4. 报告验证结果，提醒用户手动运行 supabase db push 推送到远程
```

**参考文档**: [docs/requirements/02-技术需求文档-TRD.md](../requirements/02-技术需求文档-TRD.md#安全设计)

---

#### Step 8: 配置 Supabase Auth

**目标**: 配置 Supabase 认证系统

**前置依赖**: Step 7 完成

**执行提示词**:
```
请帮我配置 Supabase Auth：

1. 在 Supabase Dashboard > Authentication > Providers 中配置：
   - Email Provider（启用）
   - 设置邮件模板（中文）

2. 创建 src/lib/auth.ts，包含：
   - signUp() - 注册
   - signIn() - 登录
   - signOut() - 登出
   - getCurrentUser() - 获取当前用户
   - requireAuth() - 认证中间件

3. 创建 src/proxy.ts（Next.js 16 路由代理），配置路由保护：
   - /dashboard, /forms/* 需要登录
   - /admin/* 需要 admin 角色
   - 其他页面公开访问

参考 docs/deployment/02-Supabase配置指南.md 的认证配置章节。

【自动验证】
完成后请自动执行以下验证：
1. 检查 src/lib/auth.ts 和 src/proxy.ts 是否存在
2. 验证路由代理配置是否正确
3. 运行 npx tsc --noEmit 检查类型错误
4. 运行 pnpm build 检查构建是否成功
5. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/deployment/02-Supabase配置指南.md](../deployment/02-Supabase配置指南.md#认证配置)

---

### 阶段3: 基础布局 (Step 9-10)

---

#### Step 9: 创建导航组件

**目标**: 创建导航栏和侧边栏组件

**前置依赖**: Step 4 完成

**执行提示词**:
```
请帮我创建导航组件：

1. 创建 src/components/layout/navbar.tsx：
   - Logo（MultiForms 文字 + 渐变色）
   - 导航链接（首页、模板库、登录/仪表盘）
   - 右侧操作（主题切换、用户菜单）
   - Glassmorphism 效果
   - 响应式设计（移动端汉堡菜单）

2. 创建 src/components/layout/sidebar.tsx：
   - 仪表盘、我的表单、模板库、数据分析
   - 退出登录按钮
   - 选中状态高亮

3. 创建 src/components/layout/tabbar.tsx：
   - 移动端底部导航
   - 4个图标按钮

参考 design-pages/public/landing.html 的导航栏样式。

【自动验证】
完成后请自动执行以下验证：
1. 检查所有导航组件文件是否存在
2. 验证组件是否正确导入依赖（lucide-react 图标等）
3. 运行 npx tsc --noEmit 检查类型错误
4. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/design/02-页面设计规范.md](../design/02-页面设计规范.md#导航组件)

---

#### Step 10: 创建页面布局结构

**目标**: 创建根布局和各类页面布局

**前置依赖**: Step 9 完成

**执行提示词**:
```
请帮我创建页面布局结构：

1. 更新 src/app/layout.tsx（根布局）：
   - 导入 Google Fonts
   - 导入 globals.css
   - 导入 Supabase 配置
   - 添加 ThemeProvider

2. 创建 src/components/layout/main-layout.tsx：
   - 包含 Navbar
   - 子内容区域
   - 适用于公开页面

3. 创建 src/components/layout/dashboard-layout.tsx：
   - 包含 Sidebar（桌面）/ Tabbar（移动）
   - 顶部用户信息栏
   - 适用于仪表盘页面

4. 创建 src/components/layout/admin-layout.tsx：
   - 紫色渐变主题（区别于前台）
   - Admin 专用侧边栏
   - 适用于管理后台

5. 创建 src/app/(public)/layout.tsx
6. 创建 src/app/(dashboard)/layout.tsx
7. 创建 src/app/(admin)/layout.tsx

参考 design-pages/ 中的各页面布局。

【自动验证】
完成后请自动执行以下验证：
1. 检查所有布局文件是否存在
2. 验证路由组织是否正确（public/dashboard/admin 分组）
3. 运行 npx tsc --noEmit 和 pnpm build 检查错误
4. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/design/02-页面设计规范.md](../design/02-页面设计规范.md)

---

### 阶段4: 认证系统 (Step 11-13)

---

#### Step 11: 创建登录页面

**目标**: 创建登录页面和表单

**前置依赖**: Step 10 完成

**执行提示词**:
```
请帮我创建登录页面 src/app/(public)/login/page.tsx：

功能需求：
1. 居中玻璃态卡片布局
2. 表单字段：
   - 邮箱输入
   - 密码输入（显示/隐藏切换）
3. 社交登录按钮（微信、Google）- 暂时禁用
4. "忘记密码"链接
5. "注册账号"链接
6. 表单验证（zod）
7. 错误提示显示

样式参考：design-pages/public/login.html

使用 react-hook-form + zod 进行表单验证。
使用 @supabase/auth-helpers-nextjs 进行认证。

【自动验证】
完成后请自动执行以下验证：
1. 检查页面文件是否存在
2. 验证表单 schema 是否正确定义
3. 运行 npx tsc --noEmit 检查类型错误
4. 运行 pnpm build 检查构建是否成功
5. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/design/04-静态页面规划.md](../design/04-静态页面规划.md#login-page)

---

#### Step 12: 创建注册页面

**目标**: 创建注册页面

**前置依赖**: Step 11 完成

**执行提示词**:
```
请帮我创建注册页面 src/app/(public)/register/page.tsx：

功能需求：
1. 居中玻璃态卡片布局
2. 表单字段：
   - 姓名输入
   - 邮箱输入
   - 密码输入（带强度指示器）
   - 确认密码输入
3. 服务条款勾选框
4. 注册按钮
5. "已有账号"登录链接
6. 表单验证（密码一致性、邮箱格式）
7. 注册成功后自动登录并跳转到仪表盘

样式参考：design-pages/public/register.html

使用 zxcvbn 或简单规则检查密码强度。

【自动验证】
完成后请自动执行以下验证：
1. 检查页面文件是否存在
2. 验证表单验证规则是否完整（密码匹配、邮箱格式）
3. 运行 npx tsc --noEmit 检查类型错误
4. 运行 pnpm build 检查构建是否成功
5. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/design/04-静态页面规划.md](../design/04-静态页面规划.md#register-page)

---

#### Step 13: 创建用户状态管理

**目标**: 创建用户状态管理和上下文

**前置依赖**: Step 12 完成

**执行提示词**:
```
请帮我创建用户状态管理：

1. 创建 src/stores/authStore.ts（Zustand）：
   - user 状态（当前用户信息）
   - profile 状态（用户资料）
   - isLoading 状态
   - signIn() 方法
   - signUp() 方法
   - signOut() 方法
   - fetchProfile() 方法

2. 创建 src/hooks/useAuth.ts：
   - 封装 authStore
   - 提供便捷的 hooks

3. 创建 src/components/providers/auth-provider.tsx：
   - 监听 Supabase 认证状态变化
   - 自动更新 authStore

4. 在根布局中添加 AuthProvider

5. 创建 src/app/(dashboard)/dashboard/loading.tsx
6. 创建 src/app/(public)/login/loading.tsx

【自动验证】
完成后请自动执行以下验证：
1. 检查 authStore.ts、useAuth.ts、auth-provider.tsx 是否存在
2. 验证 AuthProvider 是否已在根布局中引入
3. 运行 npx tsc --noEmit 检查类型错误
4. 运行 pnpm build 检查构建是否成功
5. 报告验证结果，提醒用户手动测试登录流程
```

**参考文档**: [docs/requirements/02-技术需求文档-TRD.md](../requirements/02-技术需求文档-TRD.md#认证系统)

---

### 阶段5: 核心功能 (Step 14-16)

---

#### Step 14: 创建表单 CRUD 功能

**目标**: 创建表单的创建、读取、更新、删除功能

**前置依赖**: Step 13 完成

**执行提示词**:
```
请帮我创建表单 CRUD 功能：

1. 创建 src/lib/api/forms.ts：
   - createForm() - 创建表单
   - getForms() - 获取用户的所有表单
   - getFormById() - 获取单个表单详情
   - updateForm() - 更新表单
   - deleteForm() - 删除表单
   - duplicateForm() - 复制表单

2. 创建 src/app/(dashboard)/dashboard/page.tsx：
   - Bento Grid 统计卡片（总表单数、总回复数等）
   - 快速开始 CTA 卡片
   - 最近表单列表卡片
   - 参考设计：design-pages/creator/dashboard.html

3. 创建 src/components/forms/form-card.tsx：
   - 表单预览卡片
   - 操作按钮（编辑、分析、分享、删除）

【自动验证】
完成后请自动执行以下验证：
1. 检查 forms.ts API 文件是否存在且包含所有 CRUD 方法
2. 检查 dashboard 页面和 form-card 组件是否存在
3. 验证 API 方法是否有正确的类型定义
4. 运行 npx tsc --noEmit 和 pnpm build 检查错误
5. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/design/04-静态页面规划.md](../design/04-静态页面规划.md#dashboard)

---

#### Step 15: 创建题型组件库

**目标**: 创建所有题型组件

**前置依赖**: Step 14 完成

**执行提示词**:
```
请帮我创建题型组件库：

在 src/components/forms/questions/ 目录下创建以下组件：

1. 单选题组件 single-choice.tsx
2. 多选题组件 multiple-choice.tsx
3. 下拉选择组件 dropdown.tsx
4. 评分题组件 rating.tsx（星级/数字/滑块）
5. 文本题组件 text.tsx（单行/多行）
6. 数字题组件 number.tsx
7. 日期题组件 date.tsx
8. 文件上传组件 file-upload.tsx
9. 矩阵题组件 matrix.tsx
10. 排序题组件 sorting.tsx

每个组件需要：
- 编辑状态（在构建器中）
- 填写状态（在表单页中）
- 必填标记
- 验证提示
- Glassmorphism 样式

参考 docs/design/03-组件设计规范.md 的题型组件章节。

【自动验证】
完成后请自动执行以下验证：
1. 列出 src/components/forms/questions/ 目录下所有文件
2. 确认10个题型组件是否全部创建
3. 验证组件是否正确导出
4. 运行 npx tsc --noEmit 检查类型错误
5. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/design/03-组件设计规范.md](../design/03-组件设计规范.md#题型组件)

---

#### Step 16: 创建表单构建器（拖拽功能）

**目标**: 创建拖拽式表单构建器

**前置依赖**: Step 15 完成

**执行提示词**:
```
请帮我创建表单构建器页面 src/app/(dashboard)/forms/[id]/edit/page.tsx：

功能需求：
1. 左侧题型工具箱（280px）：
   - 9种题型卡片
   - 拖拽到预览区添加题目

2. 中央表单预览区（最大宽720px）：
   - 表单标题/描述编辑
   - 题目卡片列表
   - 题目悬停显示操作按钮（编辑、复制、删除）
   - 拖拽排序功能

3. 右侧属性面板（可选）：
   - 题目属性编辑
   - 选项管理
   - 验证规则

4. 移动端：
   - 底部抽屉式工具箱
   - 点击添加题目（不支持拖拽）

使用 @dnd-kit 实现拖拽功能。
参考设计：design-pages/creator/form-builder.html

【自动验证】
完成后请自动执行以下验证：
1. 检查表单构建器页面文件是否存在
2. 验证 @dnd-kit 相关导入是否正确
3. 确认页面结构包含工具箱、预览区、属性面板
4. 运行 npx tsc --noEmit 和 pnpm build 检查错误
5. 报告验证结果，提醒用户手动测试拖拽功能
```

**参考文档**: [docs/design/04-静态页面规划.md](../design/04-静态页面规划.md#form-builder)

---

### 阶段6: 表单功能 (Step 17-18)

---

#### Step 17: 创建公开表单页面

**目标**: 创建表单填写页面

**前置依赖**: Step 16 完成

**执行提示词**:
```
请帮我创建公开表单页面 src/app/f/[shortId]/page.tsx：

功能需求：
1. 居中卡片布局（最大宽640px）
2. 表单头部：
   - Logo/封面图（可选）
   - 表单标题
   - 表单描述
3. 题目展示：
   - 单页/多页模式
   - 进度条（多页模式）
   - 必填标记
4. 底部操作：
   - 上一步/下一步按钮
   - 提交按钮
5. 提交后：
   - 成功提示动画
   - 显示结果页面（如果允许查看）

6. 密码保护：
   - 如果表单设置密码保护，先显示密码验证页
   - src/app/f/[shortId]/password-gate/page.tsx

参考设计：design-pages/public/form-view.html

【自动验证】
完成后请自动执行以下验证：
1. 检查公开表单页面文件是否存在
2. 检查密码验证页面文件是否存在
3. 验证动态路由参数 [shortId] 是否正确使用
4. 运行 npx tsc --noEmit 和 pnpm build 检查错误
5. 报告验证结果，提醒用户手动测试表单填写流程
```

**参考文档**: [docs/design/04-静态页面规划.md](../design/04-静态页面规划.md#form-view)

---

#### Step 18: 创建数据统计页面

**目标**: 创建表单数据分析页面

**前置依赖**: Step 17 完成

**执行提示词**:
```
请帮我创建数据统计页面 src/app/(dashboard)/forms/[id]/analytics/page.tsx：

功能需求：
1. 顶部导航：
   - 返回按钮
   - 表单标题
   - 操作按钮（导出、分享结果）

2. 统计卡片（4列）：
   - 总回复数
   - 完成率
   - 平均耗时
   - 今日新增

3. 回复趋势图：
   - 折线图展示每日回复数
   - 使用 recharts

4. 题目统计：
   - 单选/多选：横向柱状图
   - 评分题：星级分布图
   - 文本题：回复列表

5. 原始数据表格：
   - 分页展示
   - 可导出

参考设计：design-pages/creator/form-analytics.html

【自动验证】
完成后请自动执行以下验证：
1. 检查统计页面文件是否存在
2. 验证 recharts 组件是否正确导入
3. 确认页面结构包含统计卡片、图表、表格
4. 运行 npx tsc --noEmit 和 pnpm build 检查错误
5. 报告验证结果，如有问题请修复
```

**参考文档**: [docs/design/04-静态页面规划.md](../design/04-静态页面规划.md#form-analytics)

---

### 阶段7: 主题系统 (Step 19)

---

#### Step 19: 实现主题切换功能

**目标**: 实现8套主题动态切换

**前置依赖**: Step 4 完成

**执行提示词**:
```
请帮我实现主题切换功能：

1. 创建 src/lib/themes.ts：
   - 定义8套主题的类型和配置
   - 主题：nebula, ocean, sunset, forest, sakura, cyber, minimal, royal

2. 创建 src/stores/themeStore.ts：
   - 当前主题状态
   - 主题切换方法
   - 持久化到 localStorage

3. 创建 src/components/layout/theme-switcher.tsx：
   - 主题选择下拉菜单
   - 实时预览主题颜色

4. 创建 src/components/providers/theme-provider.tsx：
   - 根据主题设置 data-theme 属性
   - 应用主题变量

5. 在表单设置中添加主题选择：
   - 每个表单可以独立选择主题
   - 公开表单页面应用所选主题

参考 design-pages/theme-system.css 中的CSS变量。

【自动验证】
完成后请自动执行以下验证：
1. 检查 themes.ts、themeStore.ts、theme-switcher.tsx、theme-provider.tsx 是否存在
2. 验证8套主题配置是否完整定义
3. 确认 ThemeProvider 是否在根布局中引入
4. 运行 npx tsc --noEmit 和 pnpm build 检查错误
5. 报告验证结果，提醒用户手动测试主题切换
```

**参考文档**:
- [design-pages/theme-system.css](../../design-pages/theme-system.css)
- [design-pages/themes.html](../../design-pages/themes.html)

---

### 阶段8: 部署上线 (Step 20)

---

#### Step 20: 部署到 Vercel 和 Supabase

**目标**: 完成生产环境部署

**前置依赖**: Step 1-19 全部完成

**执行提示词**:
```
请帮我完成部署配置：

1. Vercel 部署：
   - 安装 Vercel CLI：npm i -g vercel
   - 运行 vercel login
   - 运行 vercel --prod
   - 配置环境变量（在 Vercel Dashboard 中）

2. Supabase 部署：
   - 确保所有迁移已推送到远程：supabase db push
   - 在 Supabase Dashboard 中配置：
     * Authentication > URL Configuration（添加 Vercel 域名）
     * Storage（如果需要文件上传）

3. 自定义域名（可选）：
   - 在 Vercel 中添加自定义域名
   - 配置 DNS 记录

4. 生产环境检查：
   - 检查所有环境变量
   - 测试登录/注册流程
   - 测试表单创建和填写
   - 检查 RLS 策略是否生效

参考 docs/deployment/01-Vercel部署指南.md 的完整步骤。

【自动验证】
完成后请自动执行以下验证：
1. 检查 vercel.json 配置文件是否存在（如有）
2. 检查 .env.example 文件是否包含所有必需的环境变量
3. 验证 .gitignore 是否正确排除敏感文件
4. 运行 npm run build 确保生产构建成功
5. 报告验证结果，并提供部署检查清单
```

**参考文档**: [docs/deployment/01-Vercel部署指南.md](../deployment/01-Vercel部署指南.md)

---

## 附录

### 常用命令

```bash
# 开发
npm run dev           # 启动开发服务器
npm run build         # 构建生产版本
npm run start         # 启动生产服务器

# 数据库
supabase start        # 启动本地 Supabase
supabase stop         # 停止本地 Supabase
supabase db push      # 推送数据库更改到远程
supabase db reset     # 重置本地数据库

# 类型生成
supabase gen types typescript --local > src/lib/database.types.ts

# 部署
vercel                # 部署到 Vercel（预览）
vercel --prod         # 部署到 Vercel（生产）
```

### 环境变量清单

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxx...

# 可选
NEXT_PUBLIC_APP_URL=https://your-domain.com
```

### 故障排查

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| npm install 失败 | Node 版本过低 | 升级到 Node 18+ |
| Supabase 连接失败 | 环境变量未配置 | 检查 .env.local |
| RLS 策略报错 | 策略未正确推送 | 运行 supabase db push |
| 样式不生效 | Tailwind 配置错误 | 检查 tailwind.config.ts |
| 404 错误 | 路由配置错误 | 检查 app 目录结构 |
| Vercel 部署错误（多区域）| regions 配置需要 Pro 计划 | 删除 vercel.json 中的 regions 配置 |
| Vercel 部署错误（包管理器）| 自动检测错误的包管理器 | 明确指定 installCommand: "npm install" |
| 构建错误（组件名冲突）| 导入组件与当前组件同名 | 重命名其中一个组件 |
| 构建错误（CSS 语法）| Tailwind 类名引号冲突 | 使用双引号 font-["Space_Grotesk"] |
| 构建错误（dnd-kit）| 导入名不正确 | useDrag → useDraggable |

---

## 更新日志

| 日期 | 版本 | 说明 |
|------|------|------|
| 2026-02-10 | 1.6.0 | 代码审查修复：密码输入安全性、排序题类型映射、性能优化、可访问性改进 |
| 2026-02-09 | 1.5.0 | 新增功能：实时模板同步、主题Hover预览切换；更新数据分析页面为两行统计卡片+热门TOP10表单排行 |
| 2026-02-08 | 1.4.0 | 新增组件文档更新：PublishModal、ConfirmDialog、TemplatesSection、TestimonialsSection |
| 2026-01-31 | 1.3.0 | 添加 Step 0（Landing Page）完成状态，更新页面规划文档实现追踪 |
| 2026-01-30 | 1.2.0 | 部署配置修复：修复 vercel.json 配置，修正构建错误，更新文档 |
| 2026-01-29 | 1.1.0 | 为每个步骤添加自动验证功能 |
| 2026-01-29 | 1.0.0 | 初始版本，20个开发步骤 |

---

## 最新功能更新

### 2026-02-09 更新内容

#### 1. 实时模板同步
- **文件**: `src/lib/templates/definitions.ts`, `src/app/templates/page.tsx`
- **功能**: 管理员创建的模板通过 Supabase Realtime 实时同步到创建者模板库
- **迁移**: `supabase/migrations/009_enable_templates_realtime.sql`

#### 2. 主题 Hover 预览切换
- **文件**: `src/components/layout/theme-switcher.tsx`, `src/lib/themes.ts`
- **功能**:
  - Hover 展开所有主题（每行一个，横向展开）
  - Hover 临时预览主题效果（页面颜色实时变化）
  - 点击确认选择主题
  - 移出不点击恢复原主题

#### 3. 数据分析页面优化
- **文件**: `src/app/analytics/page.tsx`
- **更新**:
  - 移除重复的"数据分析"标题
  - 保持两行统计卡片布局
  - "热门表单排行" 改为 "热门TOP10表单排行"

---

*本文档由 Claude AI 协助创建*
